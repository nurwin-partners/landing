# üöÄ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—é Next.js –Ω–∞ GitHub Pages
# –¶–µ–π workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–∏—Ä–∞—î —Ç–∞ –¥–µ–ø–ª–æ—ó—Ç—å –≤–∞—à —Å–∞–π—Ç –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É push –≤ main –≥—ñ–ª–∫—É

name: Deploy to GitHub Pages

# üìã TRIGGERS - –∫–æ–ª–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è workflow
on:
  push:
    branches: [main] # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ push –≤ main –≥—ñ–ª–∫—É
  workflow_dispatch: # –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub UI (–∫–Ω–æ–ø–∫–∞ "Run workflow")

# üîê PERMISSIONS - –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ GitHub Pages
permissions:
  contents: read # –ß–∏—Ç–∞—Ç–∏ –∫–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—è
  pages: write # –ü–∏—Å–∞—Ç–∏ –≤ GitHub Pages
  id-token: write # –î–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑ GitHub Pages

# üîÑ CONCURRENCY - –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞–º –ø—Ä–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö deploy
concurrency:
  group: "pages" # –ì—Ä—É–ø–∞ –¥–ª—è Pages deploy
  cancel-in-progress: false # –ù–µ –ø–µ—Ä–µ—Ä–∏–≤–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ deploy

# üèóÔ∏è JOBS - –æ—Å–Ω–æ–≤–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è workflow
jobs:
  # ===============================
  # JOB 1: BUILD - –∑–±—ñ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç—É
  # ===============================
  build:
    runs-on: ubuntu-latest # –í—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –º–∞—à–∏–Ω–∞ Ubuntu (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ)

    steps:
      # –ö–†–û–ö 1: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–¥—É –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—è
      - name: Checkout
        uses: actions/checkout@v4 # –ì–æ—Ç–æ–≤–∞ action –≤—ñ–¥ GitHub –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–¥—É

      # –ö–†–û–ö 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Node.js —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
      - name: Setup Node.js
        uses: actions/setup-node@v4 # –ì–æ—Ç–æ–≤–∞ action –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Node.js
        with:
          node-version: "20" # –í–µ—Ä—Å—ñ—è Node.js (—Å—Ç–∞–±—ñ–ª—å–Ω–∞ LTS)
          cache: "npm" # –ö–µ—à—É–≤–∞–Ω–Ω—è node_modules –¥–ª—è –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è

      # –ö–†–û–ö 3: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
      - name: Install dependencies
        run: npm ci # npm ci —à–≤–∏–¥—à–µ –∑–∞ npm install, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î package-lock.json

      # –ö–†–û–ö 4: –ó–±—ñ—Ä–∫–∞ Next.js –ø—Ä–æ–µ–∫—Ç—É
      - name: Build
        run: npm run build # –í–∏–∫–æ–Ω—É—î –∫–æ–º–∞–Ω–¥—É "build" –∑ package.json, —Å—Ç–≤–æ—Ä—é—î –ø–∞–ø–∫—É out/

      # –ö–†–û–ö 5: –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∞–∂–ª–∏–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤ –¥–æ –±—ñ–ª–¥–∞
      - name: Add CNAME and verification files
        run: |
          # –ö–æ–ø—ñ—é—î–º–æ —Ñ–∞–π–ª –¥–æ–º–µ–Ω—É (nurwin.partners) –≤ –±—ñ–ª–¥
          cp CNAME out/CNAME
          # –ö–æ–ø—ñ—é—î–º–æ Google verification —Ñ–∞–π–ª –≤ –±—ñ–ª–¥
          cp google12c92315e55d13f4.html out/google12c92315e55d13f4.html

      # –ö–†–û–ö 6: –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è GitHub Pages
      - name: Setup Pages
        uses: actions/configure-pages@v4 # –ù–∞–ª–∞—à—Ç–æ–≤—É—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è GitHub Pages

      # –ö–†–û–ö 7: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—É –¥–ª—è deploy
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3 # –°—Ç–≤–æ—Ä—é—î zip –∞—Ä—Ö—ñ–≤ –∑ —Å–∞–π—Ç–æ–º
        with:
          path: out # –í–∫–∞–∑—É—î–º–æ –ø–∞–ø–∫—É –∑ –≥–æ—Ç–æ–≤–∏–º —Å–∞–π—Ç–æ–º (out/ –≤—ñ–¥ Next.js export)

  # ===============================
  # JOB 2: DEPLOY - –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è —Å–∞–π—Ç—É
  # ===============================
  deploy:
    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–ª—è Pages
    environment:
      name: github-pages # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ —ñ–º'—è –¥–ª—è GitHub Pages
      url: ${{ steps.deployment.outputs.page_url }} # URL —Å–∞–π—Ç—É –ø—ñ—Å–ª—è deploy

    runs-on: ubuntu-latest # –í—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –º–∞—à–∏–Ω–∞ –¥–ª—è deploy
    needs: build # –ß–µ–∫–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è job "build" –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º

    steps:
      # –ö–†–û–ö 1: –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –Ω–∞ GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment # ID –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
        uses: actions/deploy-pages@v4 # –ì–æ—Ç–æ–≤–∞ action –¥–ª—è deploy –Ω–∞ Pages
